<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick Start &mdash; kerchunk  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="kerchunk" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            kerchunk
              <img src="_static/kerchunk.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                9999
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#single-file-jsons">Single file JSONs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-file-jsons">Multi-file JSONs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-output">Using the output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-tutorial-notebook">Example/Tutorial Notebook</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="detail.html">Detailed description</a></li>
<li class="toctree-l1"><a class="reference internal" href="cases.html">Case studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="spec.html">References specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="beyond.html">Beyond Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonzarr.html">Non-zarr uses</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to kerchunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">kerchunk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quick Start</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/test_example.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading"></a></h1>
<p>This is a run-through example for how to use this package. We scan a set of netCDF4/HDF5 files,
and create a single emsemble, virtual dataset, which can be read in parallel from remote
using <code class="docutils literal notranslate"><span class="pre">zarr</span></code>.</p>
<section id="single-file-jsons">
<h2>Single file JSONs<a class="headerlink" href="#single-file-jsons" title="Link to this heading"></a></h2>
<p>This will create a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file for each of the files defined in <code class="docutils literal notranslate"><span class="pre">urllist</span></code>. In this case,
we simply keep the resultant reference sets in memory, but we could have written them into
JSON files. Writing to files is useful, so that we can access the individual datasets, or
redo the combine (which is the next step, below).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">kerchunk.hdf</span>
<span class="kn">import</span> <span class="nn">fsspec</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;s3://&quot;</span> <span class="o">+</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010000.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010100.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010200.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010300.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010400.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010500.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010600.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010700.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010800.CHRTOUT_DOMAIN1.comp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;noaa-nwm-retro-v2.0-pds/full_physics/2017/201704010900.CHRTOUT_DOMAIN1.comp&#39;</span>
<span class="p">]]</span>
<span class="n">so</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_fill_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_cache_type</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>
<span class="p">)</span>
<span class="n">singles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">**</span><span class="n">so</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
        <span class="n">h5chunks</span> <span class="o">=</span> <span class="n">kerchunk</span><span class="o">.</span><span class="n">hdf</span><span class="o">.</span><span class="n">SingleHdf5ToZarr</span><span class="p">(</span><span class="n">inf</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">inline_threshold</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">singles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h5chunks</span><span class="o">.</span><span class="n">translate</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="multi-file-jsons">
<h2>Multi-file JSONs<a class="headerlink" href="#multi-file-jsons" title="Link to this heading"></a></h2>
<p>This code uses the output generated above to create a single ensemble dataset, with
one set of references pointing to all of the chunks in the individual files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kerchunk.combine</span> <span class="kn">import</span> <span class="n">MultiZarrToZarr</span>
<span class="n">mzz</span> <span class="o">=</span> <span class="n">MultiZarrToZarr</span><span class="p">(</span>
    <span class="n">singles</span><span class="p">,</span>
    <span class="n">remote_protocol</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
    <span class="n">remote_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="n">concat_dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">mzz</span><span class="o">.</span><span class="n">translate</span><span class="p">()</span>
</pre></div>
</div>
<p>Again, <code class="docutils literal notranslate"><span class="pre">out</span></code> could be written to a JSON file by providing arguments to
<code class="docutils literal notranslate"><span class="pre">translate()</span></code>. Crucially, there is no restriction on where
this lives, it can be anywhere that fsspec can read from.</p>
</section>
<section id="using-the-output">
<h2>Using the output<a class="headerlink" href="#using-the-output" title="Link to this heading"></a></h2>
<p>This is what a user of the generated dataset would do. This person does not need to have
<code class="docutils literal notranslate"><span class="pre">kerchunk</span></code> installed, or even <code class="docutils literal notranslate"><span class="pre">h5py</span></code> (the library we used to initially scan the files).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;reference://&quot;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;zarr&quot;</span><span class="p">,</span>
    <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;storage_options&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;fo&quot;</span><span class="p">:</span> <span class="n">out</span><span class="p">,</span>
            <span class="s2">&quot;remote_protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;remote_options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;anon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;consolidated&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1"># do analysis...</span>
<span class="n">ds</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>Since the invocation for xarray to read this data is a little involved, we recommend
declaring the data set in an <code class="docutils literal notranslate"><span class="pre">intake</span></code> catalog. Alternatively, you might split the command
into multiple lines by first constructing the filesystem or mapper (you will see this in some
examples).</p>
<p>Note that, if the combining was done previously and saved to a JSON file, then the path to
it should replace <code class="docutils literal notranslate"><span class="pre">out</span></code>, above, along with a <code class="docutils literal notranslate"><span class="pre">target_options</span></code> for any additional
arguments fsspec might to access it</p>
</section>
<section id="example-tutorial-notebook">
<h2>Example/Tutorial Notebook<a class="headerlink" href="#example-tutorial-notebook" title="Link to this heading"></a></h2>
<p>A set of tutorials notebooks, presented at the Earth Science Information Partners 2022 Winter Meeting, can be found at the following link, along with links to run the code on free cloud-based notebook environments: <a class="reference external" href="https://github.com/lsterzinger/2022-esip-kerchunk-tutorial">https://github.com/lsterzinger/2022-esip-kerchunk-tutorial</a></p>
<script data-goatcounter="https://kerchunk.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="kerchunk" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Martin Durant.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>